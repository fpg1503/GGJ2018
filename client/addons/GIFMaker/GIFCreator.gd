#MADE BY HENRIQUE ALVES
#MIT LICENSE
#STUFF
#YADA YADA

var file = null

func create_gif(name, images):
	print("Creating gif...")
	
	file = File.new()
	file.open("res://"+name+".gif", file.WRITE)
	
	print(images[0].get_used_rect())
	
	# ============== GIF89a header ================
	_write_word("GIF89a")
	
	# ======== Logical screen descriptor ========== 
	# Width / Height (little endian) 
	var width = images[0].get_used_rect.width
	var height = images[0].get_used_rect.height
	var lewidth = (width>>8) + ((width&0x00FF)<<8)
	var leheight = (height>>8) + ((height&0x00FF)<<8)
	_write_array_16([lewidth, leheight])
	
	# Packed Field
	var gctf = 1 # Global Color Table Flag (1b)
	var cr = 7 # Color Resolution (3b)
	var sf = 0 # Sort Flag (1b)
	var gcts = 7 # Global Color Table Size (3b)
	_write_array_8([(gctf<<7)+(cr<<4)+(sf<<3)+(gcts)])
	
	# Background Color Index
	_write_array_8([0x00])
	
	# Pixel Aspect Ratio
	_write_array_8([0x00])
	
	# ============== Global Color Table ================
	_write_complete_gct()
	
#	# Width / Height (little endian)
#	_write_array([0x0A,0x00,0x0A,0x00])
#	
#	# Global Color Table
#	
#	_write_array([0xF7,0x00,0x00])
#	_write_array([0x00,0x00,0x00])
#	for i in range(0x27):
#		_write_array([0x80,0x00,0x00])
#	for i in range(0xD7):
#		_write_array([0xFF,0x00,0x00])
#	_write_array([0xFF,0xFF,0xFF])
#	
#	# Something
#	_write_array([0x21,0xF9,0x04,0x01,0x00,0x00,0x10,0x00,0x2C,0x00,0x00,0x00,0x00,0x03,0x00,0x05,0x00,0x00,0x08,0x0B,0x00,0x51,0xFC,0x1B,0x28,0x70,0xA0,0xC1,0x83,0x01,0x01,0x00,0x3B])
#	_write_array([0x0A,0x00,0x0A,0x00,0x91,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x21,0xF9,0x04,0x00,0x00,0x00,0x00,0x00,0x2C,0x00,0x00,0x00,0x00,0x0A,0x00,0x0A,0x00,0x00,0x02,0x16,0x8C,0x2D,0x99,0x87,0x2A,0x1C,0xDC,0x33,0xA0,0x02,0x75,0xEC,0x95,0xFA,0xA8,0xDE,0x60,0x8C,0x04,0x91,0x4C,0x01,0x00,0x3B])
	
	
	print("Done!")
	file.close()

# ===================== PRIVATE METHODS ========================
func _write_complete_gct():
	pass

func _write_sequence_8(s, n):
	for i in range(n):
		file.store_8(s)

func _write_word(word):
	var buffer = word.to_ascii()
	file.store_buffer(buffer)

func _write_array_8(array):
	for i in array:
		file.store_8(i)

func _write_array_16(array):
	for i in array:
		file.store_16(i)